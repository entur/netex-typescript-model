    :root {
      --bg: #fafafa;
      --fg: #1a1a1a;
      --sidebar-bg: #f0f0f0;
      --sidebar-border: #ddd;
      --card-bg: #fff;
      --card-border: #e0e0e0;
      --accent: #2563eb;
      --accent-hover: #1d4ed8;
      --muted: #666;
      --code-bg: #f5f5f5;
      --key-color: #0550ae;
      --str-color: #0a3069;
      --num-color: #0550ae;
      --bool-color: #cf222e;
      --null-color: #cf222e;
      --link-color: #2563eb;
      --search-bg: #fff;
      --search-border: #ccc;
      --highlight-bg: #fef3c7;
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #111;
        --fg: #e0e0e0;
        --sidebar-bg: #1a1a1a;
        --sidebar-border: #333;
        --card-bg: #1e1e1e;
        --card-border: #333;
        --accent: #60a5fa;
        --accent-hover: #93bbfd;
        --muted: #999;
        --code-bg: #161616;
        --key-color: #79c0ff;
        --str-color: #a5d6ff;
        --num-color: #79c0ff;
        --bool-color: #ff7b72;
        --null-color: #ff7b72;
        --link-color: #60a5fa;
        --search-bg: #222;
        --search-border: #444;
        --highlight-bg: #3b2e00;
      }
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; scroll-padding-top: 1rem; }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--fg);
      line-height: 1.6;
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      width: 280px;
      background: var(--sidebar-bg);
      padding: 1rem;
      overflow-y: auto;
      position: sticky;
      top: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .sidebar h1 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }
    .sidebar .subtitle {
      font-size: 0.8rem;
      color: var(--muted);
      margin-bottom: 0.75rem;
    }
    .search-box {
      width: 100%;
      padding: 0.4rem 0.6rem;
      font-size: 0.85rem;
      border: 1px solid var(--search-border);
      border-radius: 0.25rem;
      background: var(--search-bg);
      color: var(--fg);
      margin-bottom: 0.5rem;
    }
    .search-box:focus { outline: 2px solid var(--accent); border-color: transparent; }
    .role-box {
      border: 1px solid var(--card-border);
      border-radius: 0.35rem;
      padding: 0.4rem 0.5rem;
      margin-bottom: 0.5rem;
    }
    .role-box-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 0.3rem;
    }
    .role-box-title {
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      color: var(--muted);
    }
    .role-help-btn {
      background: none;
      border: 1px solid var(--card-border);
      border-radius: 50%;
      width: 16px;
      height: 16px;
      font-size: 0.6rem;
      font-weight: 700;
      color: var(--muted);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      line-height: 1;
    }
    .role-help-btn:hover { color: var(--fg); border-color: var(--accent); }
    .role-filter {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }
    .role-chip {
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 10px;
      border: 1px solid var(--search-border);
      background: transparent;
      color: var(--fg);
      cursor: pointer;
      font-family: system-ui, sans-serif;
      line-height: 1.4;
    }
    .role-chip.active {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
    }
    .role-chip:hover:not(.active) { background: var(--card-border); }
    .role-help-overlay {
      display: none;
      position: fixed;
      inset: 0;
      z-index: 100;
      background: rgba(0,0,0,0.4);
      align-items: center;
      justify-content: center;
    }
    .role-help-overlay.open { display: flex; }
    .role-help-dialog {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 0.5rem;
      padding: 1.25rem 1.5rem;
      max-width: 480px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
    }
    .role-help-dialog h3 {
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
    }
    .role-help-dialog p, .role-help-dialog li {
      font-size: 0.82rem;
      line-height: 1.55;
      color: var(--fg);
    }
    .role-help-dialog p { margin-bottom: 0.5rem; }
    .role-help-dialog ul { margin: 0.25rem 0 0.5rem 1.2rem; }
    .role-help-dialog li { margin-bottom: 0.2rem; }
    .role-help-dialog strong { color: var(--accent); font-weight: 600; }
    .role-help-dialog .close-row {
      text-align: right;
      margin-top: 0.75rem;
    }
    .role-help-dialog .close-row button {
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 0.25rem;
      padding: 0.3rem 0.9rem;
      font-size: 0.8rem;
      cursor: pointer;
    }
    .role-help-dialog .close-row button:hover { background: var(--accent-hover); }
    .sidebar-count {
      font-size: 0.75rem;
      color: var(--muted);
      margin-bottom: 0.5rem;
    }
    .sidebar-list {
      list-style: none;
      overflow-y: auto;
      flex: 1;
    }
    .sidebar-list li { margin: 0; }
    .sidebar-link {
      display: block;
      padding: 0.15rem 0.4rem;
      font-size: 0.8rem;
      font-family: ui-monospace, monospace;
      color: var(--fg);
      text-decoration: none;
      border-radius: 0.2rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .sidebar-link:hover { background: var(--card-border); }
    .sidebar-link.hidden { display: none; }

    /* Main content */
    main {
      flex: 1;
      padding: 1.5rem 2rem;
      min-width: 0;
    }
    .def-section {
      margin-bottom: 2rem;
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 0.5rem;
      padding: 1.25rem;
    }
    .def-section:target {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px var(--accent);
    }
    .def-section h2 {
      font-size: 1.1rem;
      font-weight: 600;
      font-family: ui-monospace, monospace;
      margin-bottom: 0.5rem;
    }
    .permalink {
      color: var(--muted);
      text-decoration: none;
      margin-right: 0.25rem;
    }
    .permalink:hover { color: var(--accent); }
    .def-desc {
      font-size: 0.9rem;
      color: var(--muted);
      margin-bottom: 0.75rem;
      max-width: 60rem;
    }
    pre {
      background: var(--code-bg);
      border-radius: 0.35rem;
      padding: 0.75rem 1rem;
      overflow-x: auto;
      font-size: 0.8rem;
      line-height: 1.5;
    }
    code { font-family: ui-monospace, 'Cascadia Code', 'JetBrains Mono', monospace; }
    .jv-key { color: var(--key-color); }
    .jv-str { color: var(--str-color); }
    .jv-num { color: var(--num-color); }
    .jv-bool { color: var(--bool-color); }
    .jv-null { color: var(--null-color); font-style: italic; }
    .ref-link { color: var(--link-color); text-decoration: underline; text-decoration-style: dotted; }
    .ref-link:hover { text-decoration-style: solid; }

    /* Mobile: collapse sidebar */
    .sidebar-toggle { display: none; }
    @media (max-width: 768px) {
      .sidebar {
        position: fixed;
        left: -280px;
        z-index: 10;
        transition: left 0.2s;
      }
      .sidebar.open { left: 0; }
      .sidebar-toggle {
        display: block;
        position: fixed;
        top: 0.5rem;
        left: 0.5rem;
        z-index: 11;
        background: var(--accent);
        color: #fff;
        border: none;
        border-radius: 0.25rem;
        padding: 0.3rem 0.6rem;
        font-size: 0.85rem;
        cursor: pointer;
      }
      main { padding: 1rem; padding-top: 2.5rem; }
      .explore-btn, .suggest-btn, .used-by-wrap { display: none; }
    }

    /* Section action buttons */
    .explore-btn, .suggest-btn, .used-by-btn {
      float: right;
      border-radius: 0.25rem;
      padding: 0.2rem 0.55rem;
      font-size: 0.75rem;
      cursor: pointer;
      font-family: system-ui, sans-serif;
      font-weight: 500;
      margin-left: 0.35rem;
    }
    .explore-btn {
      background: color-mix(in srgb, var(--accent) 12%, transparent);
      color: var(--accent);
      border: 1px solid color-mix(in srgb, var(--accent) 35%, transparent);
    }
    .explore-btn:hover { background: color-mix(in srgb, var(--accent) 22%, transparent); border-color: var(--accent); }
    .suggest-btn {
      background: color-mix(in srgb, #16a34a 12%, transparent);
      color: #16a34a;
      border: 1px solid color-mix(in srgb, #16a34a 35%, transparent);
    }
    .suggest-btn:hover { background: color-mix(in srgb, #16a34a 22%, transparent); border-color: #16a34a; }
    @media (prefers-color-scheme: dark) {
      .suggest-btn { color: #4ade80; border-color: color-mix(in srgb, #4ade80 35%, transparent); background: color-mix(in srgb, #4ade80 12%, transparent); }
      .suggest-btn:hover { background: color-mix(in srgb, #4ade80 22%, transparent); border-color: #4ade80; }
    }
    .used-by-wrap { float: right; position: relative; margin-left: 0.35rem; line-height: 0; }
    .used-by-btn {
      float: none;
      margin-left: 0;
      background: color-mix(in srgb, #d97706 12%, transparent);
      color: #d97706;
      border: 1px solid color-mix(in srgb, #d97706 35%, transparent);
    }
    .used-by-btn:hover { background: color-mix(in srgb, #d97706 22%, transparent); border-color: #d97706; }
    @media (prefers-color-scheme: dark) {
      .used-by-btn { color: #fbbf24; border-color: color-mix(in srgb, #fbbf24 35%, transparent); background: color-mix(in srgb, #fbbf24 12%, transparent); }
      .used-by-btn:hover { background: color-mix(in srgb, #fbbf24 22%, transparent); border-color: #fbbf24; }
    }
    .used-by-dropdown {
      display: none;
      position: absolute;
      line-height: 1.5;
      right: 0;
      top: 100%;
      margin-top: 0.25rem;
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 0.35rem;
      padding: 0.5rem;
      min-width: 220px;
      max-width: 360px;
      max-height: 280px;
      overflow-y: auto;
      box-shadow: 0 4px 16px rgba(0,0,0,0.12);
      z-index: 20;
    }
    .used-by-dropdown.open { display: block; }
    .used-by-dropdown .ub-spinner {
      width: 18px; height: 18px; margin: 0.5rem auto;
      border: 2px solid var(--card-border); border-top-color: #d97706;
      border-radius: 50%; animation: spin 0.6s linear infinite;
    }
    .used-by-dropdown .ub-empty {
      font-size: 0.8rem; color: var(--muted); font-style: italic; padding: 0.25rem 0;
    }
    .used-by-dropdown .ub-count {
      font-size: 0.7rem; color: var(--muted); margin-bottom: 0.3rem;
    }
    .used-by-dropdown .ub-list {
      display: flex; flex-wrap: wrap; gap: 0.25rem;
    }
    .used-by-dropdown .ub-chip {
      display: inline-block;
      padding: 0.1rem 0.4rem;
      font-size: 0.72rem;
      font-family: ui-monospace, monospace;
      background: var(--code-bg);
      border: 1px solid var(--card-border);
      border-radius: 0.2rem;
      color: var(--link-color);
      cursor: pointer;
      text-decoration: none;
    }
    .used-by-dropdown .ub-chip:hover { border-color: var(--accent); background: var(--card-bg); }

    /* Mode chip in explorer header */
    .mode-chip {
      display: inline-block;
      font-size: 0.6rem;
      font-weight: 700;
      font-family: system-ui, sans-serif;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      padding: 0.1rem 0.4rem;
      border-radius: 0.2rem;
      margin-right: 0.4rem;
      vertical-align: middle;
      line-height: 1.4;
    }
    .mode-chip.explore { background: color-mix(in srgb, var(--accent) 18%, transparent); color: var(--accent); }
    .mode-chip.code { background: color-mix(in srgb, #16a34a 18%, transparent); color: #16a34a; }
    @media (prefers-color-scheme: dark) {
      .mode-chip.code { color: #4ade80; background: color-mix(in srgb, #4ade80 18%, transparent); }
    }

    /* Explorer panel */
    .explorer-panel {
      width: 0;
      overflow: hidden;
      background: var(--sidebar-bg);
      position: sticky;
      top: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 0;
    }
    body.explorer-open .explorer-panel {
      width: 380px;
      padding: 1rem;
    }
    .explorer-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.25rem;
    }
    .explorer-header h2 {
      font-size: 1rem;
      font-family: ui-monospace, monospace;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .explorer-close {
      background: none;
      border: none;
      font-size: 1.4rem;
      cursor: pointer;
      color: var(--muted);
      padding: 0 0.25rem;
      line-height: 1;
    }
    .explorer-close:hover { color: var(--fg); }
    .explorer-subtitle {
      font-size: 0.75rem;
      color: var(--muted);
      margin-bottom: 0.75rem;
    }
    .explorer-body { flex: 1; min-height: 0; }
    .origin-group { margin-bottom: 0.75rem; }
    .origin-heading {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--accent);
      font-family: ui-monospace, monospace;
      padding: 0.25rem 0;
      border-bottom: 1px solid var(--card-border);
      margin-bottom: 0.25rem;
    }
    .origin-heading a {
      color: inherit;
      text-decoration: none;
    }
    .origin-heading a:hover { text-decoration: underline; }
    .prop-row {
      padding: 0.3rem 0.4rem;
      border-radius: 0.2rem;
      font-size: 0.8rem;
    }
    .prop-row:nth-child(even) { background: var(--code-bg); }
    .prop-name {
      font-family: ui-monospace, monospace;
      font-weight: 600;
      color: var(--fg);
    }
    .prop-type {
      font-family: ui-monospace, monospace;
      color: var(--accent);
      font-size: 0.75rem;
    }
    .prop-type a { color: inherit; text-decoration: underline dotted; }
    .prop-type a:hover { text-decoration-style: solid; }
    .prop-pdesc {
      font-size: 0.7rem;
      color: var(--muted);
      margin-top: 0.1rem;
    }

    /* Explorer tabs */
    .explorer-tabs {
      display: flex;
      gap: 0;
      border-bottom: 1px solid var(--card-border);
      margin-bottom: 0.75rem;
      flex-shrink: 0;
    }
    .explorer-tab {
      flex: 1;
      padding: 0.35rem 0;
      background: none;
      border: none;
      border-bottom: 2px solid transparent;
      font-size: 0.8rem;
      font-weight: 500;
      color: var(--muted);
      cursor: pointer;
      font-family: system-ui, sans-serif;
    }
    .explorer-tab:hover { color: var(--fg); }
    .explorer-tab.active { color: var(--accent); border-bottom-color: var(--accent); }
    .explorer-tab-content { display: none; flex: 1; min-height: 0; overflow-y: auto; }
    .explorer-tab-content.active { display: block; }
    .graph-container { width: 100%; }
    .graph-container svg { display: block; }
    .graph-node { cursor: pointer; }
    .graph-node:hover rect { opacity: 0.8; }

    /* Interface tab */
    .iface-toggle {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      font-size: 0.75rem;
      color: var(--muted);
      cursor: pointer;
      position: sticky;
      top: 0;
      z-index: 1;
      background: var(--bg);
      padding: 0.35rem 0;
    }
    .iface-toggle input { margin: 0; cursor: pointer; }
    .interface-block {
      position: relative;
      background: var(--code-bg);
      border-radius: 0.35rem;
      padding: 0.75rem 1rem;
      overflow-x: auto;
      font-size: 0.78rem;
      line-height: 1.6;
      font-family: ui-monospace, 'Cascadia Code', 'JetBrains Mono', monospace;
      white-space: pre;
    }
    .if-kw { color: var(--bool-color); font-weight: 600; }
    .if-prop { color: var(--fg); }
    .if-prop[data-via] { text-decoration: underline dotted var(--muted); text-underline-offset: 2px; cursor: help; }
    .if-prop[data-via]:hover { text-decoration-color: var(--fg); }
    .if-prim { color: var(--num-color); }
    .if-lit { color: var(--str-color); }
    .if-cmt { color: var(--muted); font-style: italic; }
    .if-ref { color: var(--link-color); text-decoration: underline dotted; cursor: pointer; }
    .if-ref:hover { text-decoration-style: solid; }
    .via-popup {
      position: fixed;
      z-index: 1000;
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 0.35rem;
      padding: 0.5rem 0.65rem;
      font-size: 0.72rem;
      line-height: 1.5;
      font-family: ui-monospace, 'Cascadia Code', 'JetBrains Mono', monospace;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      pointer-events: none;
      white-space: nowrap;
    }
    .via-popup .via-arrow { color: var(--muted); margin: 0 0.25em; }
    .via-popup .via-name { color: var(--fg); }
    .via-popup .via-rule { color: var(--muted); font-style: italic; font-size: 0.66rem; }
    .via-popup .via-name.via-link { color: var(--link-color); }
    .copy-btn {
      position: absolute;
      top: 0.4rem;
      right: 0.4rem;
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 0.25rem;
      padding: 0.15rem 0.4rem;
      font-size: 0.7rem;
      cursor: pointer;
      color: var(--muted);
    }
    .copy-btn:hover { color: var(--fg); border-color: var(--accent); }
    .spinner {
      width: 24px; height: 24px; margin: 2rem auto;
      border: 3px solid var(--card-border); border-top-color: var(--accent);
      border-radius: 50%; animation: spin 0.6s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Loading overlay (shown until JS setup completes) */
    .loading-overlay {
      position: fixed;
      inset: 0;
      z-index: 9999;
      background: var(--bg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 1rem;
    }
    .loading-overlay .loading-spinner {
      width: 36px; height: 36px;
      border: 3px solid var(--card-border); border-top-color: var(--accent);
      border-radius: 50%; animation: spin 0.6s linear infinite;
    }
    .loading-overlay .loading-text {
      font-size: 0.85rem;
      color: var(--muted);
    }

    /* Mapping tab */
    .mapping-section { margin-bottom: 1rem; }
    .mapping-section h3 {
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.4rem;
    }
    .ref-list { display: flex; flex-wrap: wrap; gap: 0.3rem; margin-top: 0.25rem; }
    .ref-chip {
      display: inline-block;
      padding: 0.15rem 0.45rem;
      font-size: 0.72rem;
      font-family: ui-monospace, monospace;
      background: var(--code-bg);
      border: 1px solid var(--card-border);
      border-radius: 0.2rem;
      color: var(--link-color);
      cursor: pointer;
      text-decoration: none;
    }
    .ref-chip:hover { border-color: var(--accent); background: var(--card-bg); }
    .ref-empty { font-size: 0.75rem; color: var(--muted); font-style: italic; }

    /* Empty-state and utility labels */
    .explorer-empty { color: var(--muted); font-size: 0.85rem; padding: 0.5rem; }
    .mapping-intro { color: var(--muted); font-size: 0.85rem; margin: 0 0 1rem 0; }
    .utils-section { margin-bottom: 0.5rem; }
    .utils-label { font-size: 0.75rem; font-weight: 600; color: var(--fg); }

    /* Resize handles */
    .resize-handle {
      width: 4px;
      flex-shrink: 0;
      cursor: col-resize;
      background: var(--sidebar-border);
      position: sticky;
      top: 0;
      height: 100vh;
      z-index: 2;
    }
    .resize-handle:hover, .resize-handle.active {
      background: var(--accent);
    }
    #handle2 { display: none; }
    body.explorer-open #handle2 { display: block; }
    body.resizing { cursor: col-resize !important; }
    body.resizing * { user-select: none !important; pointer-events: none !important; }
    body.resizing .resize-handle { pointer-events: auto !important; }
    @media (max-width: 768px) {
      .resize-handle { display: none !important; }
    }